# 乡镇地块功能说明

## 📋 功能概览

乡镇地块功能为农情遥感系统大屏提供了乡镇级别的行政区划可视化展示，每个乡镇以矩形地块的形式显示在地图上，支持交互操作和数据查看。

## 🏘️ 功能特性

### 1. 乡镇地块显示
- **矩形地块**: 每个乡镇以矩形框的形式显示
- **统一颜色**: 所有乡镇使用统一的青色（#00FFFF）主题色
- **标签显示**: 每个地块显示乡镇名称标签
- **3D效果**: 轻微的立体效果增强视觉层次

### 2. 交互功能
- **点击查看**: 点击乡镇地块显示详细信息弹窗
- **高亮显示**: 支持高亮指定乡镇地块
- **可见性控制**: 可以显示/隐藏所有乡镇地块
- **区域联动**: 与顶部区域选择器完全联动
  - 选择"全县"显示所有乡镇地块
  - 选择特定乡镇只显示该乡镇地块
  - 自动聚焦到选中的乡镇区域

### 3. 数据展示
- **基本信息**: 乡镇名称、面积、人口
- **统计数据**: 总乡镇数、总人口、总面积、平均值
- **排序功能**: 按人口密度排序显示

## 📊 包含的乡镇数据

系统包含临夏县10个乡镇的完整数据（与区域选择器保持一致）：

| 乡镇名称 | 区域ID | 人口(人) | 面积(km²) | 人口密度(人/km²) |
|---------|--------|---------|----------|----------------|
| 城关镇   | chengguan | 28,000  | 85.6     | 327.1          |
| 土场镇   | tuchang   | 22,000  | 72.3     | 304.3          |
| 北塔镇   | beita     | 18,000  | 68.9     | 261.2          |
| 红光镇   | hongguang | 25,000  | 78.4     | 318.9          |
| 积石山镇 | jishishan | 32,000  | 92.1     | 347.3          |
| 韩家集镇 | hanjiaji  | 26,000  | 81.7     | 318.2          |
| 新集镇   | xinji     | 15,000  | 58.2     | 257.7          |
| 刘家峡镇 | liujiaxia | 19,000  | 65.8     | 288.8          |
| 太平镇   | taiping   | 24,000  | 76.5     | 313.7          |
| 民丰镇   | minfeng   | 21,000  | 69.3     | 303.0          |

## 🎮 使用方法

### 1. 基本操作
- **查看地块**: 地图加载完成后自动显示所有乡镇地块
- **点击交互**: 点击任意乡镇地块查看详细信息
- **关闭弹窗**: 点击弹窗右上角的×按钮或点击空白区域

### 2. 控制面板操作
- **显示/隐藏**: 使用控制面板的开关切换地块显示状态
- **查看统计**: 控制面板显示乡镇总体统计信息
- **选择乡镇**: 点击乡镇列表中的项目高亮对应地块

### 3. 页面支持
乡镇地块功能已集成到以下页面：
- ✅ 主页面 (index.html) - 作物分布功能
- ✅ 灾害监测 (disaster-monitoring.html)
- ✅ 长势分析 (growth-analysis.html)
- ✅ 气象监测 (weather-monitoring.html)
- ✅ 产量预估 (yield-estimation.html)

## 🔧 技术实现

### 1. 核心文件
- `assets/js/township-blocks.js` - 乡镇地块核心逻辑
- `assets/css/township-blocks.css` - 乡镇地块样式
- `township-test.html` - 独立测试页面

### 2. 主要函数
```javascript
// 初始化乡镇地块
window.TownshipBlocks.init()

// 设置可见性
window.TownshipBlocks.setVisibility(true/false)

// 区域过滤（核心联动功能）
window.TownshipBlocks.filterByRegion('all') // 显示所有
window.TownshipBlocks.filterByRegion('chengguan') // 只显示城关镇

// 聚焦到乡镇
window.TownshipBlocks.focusOn(townshipData)

// 高亮乡镇
window.TownshipBlocks.highlight('乡镇名称')

// 获取统计信息
window.TownshipBlocks.getStatistics()

// 清理资源
window.TownshipBlocks.cleanup()
```

### 3. 数据结构
```javascript
const TOWNSHIP_DATA = {
    '乡镇名称': {
        name: '乡镇名称',
        bounds: [west, south, east, north], // 经纬度边界
        population: 人口数量,
        area: 面积,
        color: '#00FFFF' // 统一颜色
    }
}
```

## 🎨 样式特性

### 1. 地块样式
- **填充色**: 青色半透明 (#00FFFF, alpha: 0.3)
- **边框色**: 青色实线 (#00FFFF, width: 2px)
- **高亮时**: 透明度增加到0.8，边框加粗到4px

### 2. 弹窗样式
- **毛玻璃效果**: backdrop-filter: blur(10px)
- **科技感边框**: 青色发光边框
- **动画效果**: 淡入动画和缩放效果

### 3. 控制面板样式
- **位置**: 右侧固定定位
- **背景**: 半透明深色背景
- **交互**: 悬浮高亮效果

## 🚀 扩展功能

### 1. 已实现功能
- ✅ 基础地块显示
- ✅ 点击交互
- ✅ 信息弹窗
- ✅ 可见性控制
- ✅ 高亮功能
- ✅ 统计信息
- ✅ 控制面板
- ✅ 区域选择器联动
- ✅ 自动聚焦功能
- ✅ 过滤显示功能

### 2. 可扩展功能
- 🔄 动态数据加载
- 🔄 多种颜色主题
- 🔄 地块分类显示
- 🔄 数据钻取功能
- 🔄 导出功能
- 🔄 搜索功能

## 📱 兼容性

### 1. 浏览器支持
- ✅ Chrome 80+
- ✅ Firefox 75+
- ✅ Safari 13+
- ✅ Edge 80+

### 2. 分辨率支持
- ✅ 1920×1080 (推荐)
- ✅ 1366×768
- ✅ 1024×768

## 🐛 故障排除

### 1. 常见问题
**问题**: 乡镇地块不显示
**解决**: 检查Cesium是否正确初始化，确保有足够的初始化延迟时间

**问题**: 点击无响应
**解决**: 确保事件监听器正确绑定，检查控制台错误信息

**问题**: 弹窗位置不正确
**解决**: 检查屏幕坐标转换，确保点击位置计算正确

### 2. 调试方法
```javascript
// 检查乡镇地块模块是否加载
console.log(window.TownshipBlocks);

// 检查Cesium实例
console.log(window.cesiumViewer);

// 查看乡镇数据
console.log(window.TownshipBlocks.data);
```

## 📝 更新日志

### v1.0.0 (2024-01-15)
- ✅ 初始版本发布
- ✅ 基础乡镇地块显示功能
- ✅ 交互和弹窗功能
- ✅ 控制面板集成
- ✅ 多页面支持

---

**开发团队**: 农情遥感系统开发组  
**最后更新**: 2024-01-15  
**版本**: v1.0.0
