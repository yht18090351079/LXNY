<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>业务统计报表 - 农情遥感系统管理端</title>
    <link rel="stylesheet" href="../../assets/css/common.css">
    <link rel="stylesheet" href="../../assets/css/reports.css">
    <link rel="stylesheet" href="../../assets/css/business.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <!-- 导航修复样式 -->
    <style>
    .nav-group .nav-item {
        cursor: pointer !important;
        user-select: none;
    }
    
    .nav-submenu {
        overflow: hidden !important;
        transition: max-height 0.3s ease !important;
        display: block !important;
    }
    
    .nav-group.expanded .nav-submenu {
        max-height: 300px !important;
    }
    
    .nav-group:not(.expanded) .nav-submenu {
        max-height: 0 !important;
    }
    
    .nav-subitem.active {
        background-color: rgba(255, 255, 255, 0.1) !important;
        color: #4CAF50 !important;
    }
    </style>
</head>
<body>
    <!-- 顶部导航栏 -->
    <header class="header">
        <div class="header-left">
            <div class="logo">
                <i class="fas fa-seedling"></i>
                <span class="logo-text">农情遥感管理系统</span>
            </div>
        </div>
        
        <div class="header-center">
            <div class="breadcrumb">
                <i class="fas fa-home"></i>
                <span>统计报表</span>
                <i class="fas fa-chevron-right"></i>
                <span>业务统计</span>
            </div>
        </div>
        
        <div class="header-right">
            <div class="search-container">
                <i class="fas fa-search search-icon"></i>
                <input type="text" class="search-input" placeholder="搜索报表...">
            </div>
            
            <div class="header-time">
                <i class="fas fa-clock"></i>
                <span id="current-time">2024-01-15 14:30:25</span>
            </div>
            
            <div class="user-menu">
                <div class="user-avatar" onclick="toggleUserMenu()">
                    <i class="fas fa-user"></i>
                    <span class="user-name">管理员</span>
                    <i class="fas fa-chevron-down"></i>
                </div>
                
                <div class="user-dropdown" id="userDropdown">
                    <a href="#" onclick="showUserProfile()">
                        <i class="fas fa-user-circle"></i>
                        个人信息
                    </a>
                    <a href="#" onclick="showSystemSettings()">
                        <i class="fas fa-cog"></i>
                        系统设置
                    </a>
                    <a href="#" onclick="logout()">
                        <i class="fas fa-sign-out-alt"></i>
                        退出登录
                    </a>
                </div>
            </div>
        </div>
    </header>

    <!-- 侧边栏导航 -->
    <aside class="sidebar" id="sidebar">
        <nav class="nav-menu">
            <!-- 仪表板 -->
            <div class="nav-item" onclick="window.location.href='../../index.html'">
                <i class="nav-icon fas fa-tachometer-alt"></i>
                <span class="nav-text">仪表板</span>
            </div>
            
            <!-- 数据管理 -->
            <div class="nav-group">
                <div class="nav-item">
                    <i class="nav-icon fas fa-database"></i>
                    <span class="nav-text">数据管理</span>
                    <i class="nav-arrow fas fa-chevron-right"></i>
                </div>
                <div class="nav-submenu">
                    <a href="../data-management/remote-sensing.html" class="nav-subitem">
                        <i class="fas fa-satellite"></i>
                        遥感数据管理
                    </a>
                    <a href="../data-management/weather-data.html" class="nav-subitem">
                        <i class="fas fa-cloud-sun"></i>
                        气象数据管理
                    </a>
                    <a href="../data-management/crop-data.html" class="nav-subitem">
                        <i class="fas fa-seedling"></i>
                        作物数据管理
                    </a>
                    <a href="../data-management/gis-data.html" class="nav-subitem">
                        <i class="fas fa-map"></i>
                        地理数据管理
                    </a>
                    <a href="../data-management/weather-alert-logs.html" class="nav-subitem">
                        <i class="fas fa-exclamation-triangle"></i>
                        预警信息留痕
                    </a>
                </div>
            </div>
            
            <!-- 设备管理 -->
            <div class="nav-group">
                <div class="nav-item">
                    <i class="nav-icon fas fa-microchip"></i>
                    <span class="nav-text">设备管理</span>
                    <i class="nav-arrow fas fa-chevron-right"></i>
                </div>
                <div class="nav-submenu">
                    <a href="../device-management/sensors.html" class="nav-subitem">
                        <i class="fas fa-thermometer-half"></i>
                        传感器管理
                    </a>
                    <a href="../device-management/device-monitoring.html" class="nav-subitem">
                        <i class="fas fa-video"></i>
                        监控设备
                    </a>
                    <a href="../device-management/maintenance.html" class="nav-subitem">
                        <i class="fas fa-tools"></i>
                        设备维护
                    </a>
                </div>
            </div>
            
            <!-- 用户管理 -->
            <div class="nav-group">
                <div class="nav-item">
                    <i class="nav-icon fas fa-users"></i>
                    <span class="nav-text">用户管理</span>
                    <i class="nav-arrow fas fa-chevron-right"></i>
                </div>
                <div class="nav-submenu">
                    <a href="../user-management/users.html" class="nav-subitem">
                        <i class="fas fa-user"></i>
                        用户账户
                    </a>
                    <a href="../user-management/roles.html" class="nav-subitem">
                        <i class="fas fa-user-tag"></i>
                        角色权限
                    </a>
                    <a href="../user-management/logs.html" class="nav-subitem">
                        <i class="fas fa-history"></i>
                        操作日志
                    </a>
                </div>
            </div>
            
            <!-- 系统设置 -->
            <div class="nav-group">
                <div class="nav-item">
                    <i class="nav-icon fas fa-cogs"></i>
                    <span class="nav-text">系统设置</span>
                    <i class="nav-arrow fas fa-chevron-right"></i>
                </div>
                <div class="nav-submenu">
                    <a href="../system-settings/display.html" class="nav-subitem">
                        <i class="fas fa-desktop"></i>
                        大屏配置
                    </a>
                    <a href="../system-settings/algorithms.html" class="nav-subitem">
                        <i class="fas fa-brain"></i>
                        算法参数
                    </a>
                    <a href="../system-settings/system-monitoring.html" class="nav-subitem">
                        <i class="fas fa-heartbeat"></i>
                        系统监控
                    </a>
                </div>
            </div>
            
            <!-- 统计报表 -->
            <div class="nav-group expanded">
                <div class="nav-item">
                    <i class="nav-icon fas fa-chart-line"></i>
                    <span class="nav-text">统计报表</span>
                    <i class="nav-arrow fas fa-chevron-right"></i>
                </div>
                <div class="nav-submenu">
                    <a href="data-quality.html" class="nav-subitem">
                        <i class="fas fa-chart-bar"></i>
                        数据质量报告
                    </a>
                    <a href="business.html" class="nav-subitem active">
                        <i class="fas fa-chart-pie"></i>
                        业务统计
                    </a>
                    <a href="export.html" class="nav-subitem">
                        <i class="fas fa-download"></i>
                        数据导出
                    </a>
                </div>
            </div>
        </nav>
    </aside>
    <!-- 主内容区域 -->
    <main class="main-content">
        <!-- 页面内容 -->
        <div class="content-wrapper">
            <div class="page-header">
                <div class="page-title">
                    <h1>
                        <i class="fas fa-chart-bar"></i>
                        业务统计报表
                    </h1>
                    <p class="page-description">全面分析农业遥感业务数据，提供深入的业务洞察和决策支持</p>
                </div>
                <div class="page-actions">
                    <div class="date-range-picker date-range-inline-action">
                        <input type="date" id="startDate" class="form-input">
                        <span>至</span>
                        <input type="date" id="endDate" class="form-input">
                        <button class="btn btn-secondary" id="applyDateRange">
                            <i class="fas fa-filter"></i>
                            应用
                        </button>
                    </div>
                    <button class="btn btn-secondary" id="refreshBtn">
                        <i class="fas fa-sync-alt"></i>
                        刷新
                    </button>
                    <button class="btn btn-primary" id="exportReportBtn">
                        <i class="fas fa-download"></i>
                        导出报表
                    </button>
                </div>
            </div>
            <!-- 业务概览 -->
            <div class="business-overview">
                <div class="overview-cards">
                    <div class="business-card primary">
                        <div class="card-header">
                            <div class="card-icon">
                                <i class="fas fa-leaf"></i>
                            </div>
                            <div class="card-info">
                                <h3>监测面积</h3>
                                <p class="card-value" id="monitoringArea">12,456</p>
                                <p class="card-unit">公顷</p>
                            </div>
                        </div>
                        <div class="card-trend">
                            <i class="fas fa-arrow-up trend-up"></i>
                            <span>+8.5%</span>
                            <small>较上月</small>
                        </div>
                    </div>
                    <div class="business-card success">
                        <div class="card-header">
                            <div class="card-icon">
                                <i class="fas fa-satellite"></i>
                            </div>
                            <div class="card-info">
                                <h3>遥感影像</h3>
                                <p class="card-value" id="satelliteImages">1,247</p>
                                <p class="card-unit">景</p>
                            </div>
                        </div>
                        <div class="card-trend">
                            <i class="fas fa-arrow-up trend-up"></i>
                            <span>+12.3%</span>
                            <small>较上月</small>
                        </div>
                    </div>
                    <div class="business-card warning">
                        <div class="card-header">
                            <div class="card-icon">
                                <i class="fas fa-exclamation-triangle"></i>
                            </div>
                            <div class="card-info">
                                <h3>灾害预警</h3>
                                <p class="card-value" id="disasterAlerts">23</p>
                                <p class="card-unit">次</p>
                            </div>
                        </div>
                        <div class="card-trend">
                            <i class="fas fa-arrow-down trend-down"></i>
                            <span>-15.2%</span>
                            <small>较上月</small>
                        </div>
                    </div>
                    <div class="business-card info">
                        <div class="card-header">
                            <div class="card-icon">
                                <i class="fas fa-chart-line"></i>
                            </div>
                            <div class="card-info">
                                <h3>产量预估</h3>
                                <p class="card-value" id="yieldForecast">8,934</p>
                                <p class="card-unit">吨</p>
                            </div>
                        </div>
                        <div class="card-trend">
                            <i class="fas fa-arrow-up trend-up"></i>
                            <span>+5.7%</span>
                            <small>较上月</small>
                        </div>
                    </div>
                </div>
            </div>
            <!-- 业务统计图表 -->
            <div class="content-grid">
                <!-- 月度业务趋势 -->
                <div class="content-card full-width">
                    <div class="card-header">
                        <h3>
                            <i class="fas fa-chart-area"></i>
                            月度业务趋势分析
                        </h3>
                        <div class="card-actions">
                            <div class="chart-controls">
                                <button class="chart-btn active" data-metric="area">监测面积</button>
                                <button class="chart-btn" data-metric="images">影像数量</button>
                                <button class="chart-btn" data-metric="yield">产量预估</button>
                                <button class="chart-btn" data-metric="alerts">预警次数</button>
                            </div>
                        </div>
                    </div>
                    <div class="card-content">
                        <div id="businessTrendChart" class="chart-container large"></div>
                    </div>
                </div>
                <!-- 作物类型分布 -->
                <div class="content-card">
                    <div class="card-header">
                        <h3>
                            <i class="fas fa-seedling"></i>
                            作物类型分布
                        </h3>
                        <div class="card-actions">
                            <select id="cropRegion" class="form-select">
                                <option value="all">全部区域</option>
                                <option value="north">北部地区</option>
                                <option value="south">南部地区</option>
                                <option value="east">东部地区</option>
                                <option value="west">西部地区</option>
                            </select>
                        </div>
                    </div>
                    <div class="card-content">
                        <div id="cropDistributionChart" class="chart-container"></div>
                    </div>
                </div>
                <!-- 设备使用率统计 -->
                <div class="content-card">
                    <div class="card-header">
                        <h3>
                            <i class="fas fa-cogs"></i>
                            设备使用率统计
                        </h3>
                        <div class="card-actions">
                            <button class="btn btn-ghost btn-sm" id="refreshDeviceBtn">
                                <i class="fas fa-sync-alt"></i>
                            </button>
                        </div>
                    </div>
                    <div class="card-content">
                        <div id="deviceUsageChart" class="chart-container"></div>
                    </div>
                </div>
                <!-- 区域业务对比 -->
                <div class="content-card">
                    <div class="card-header">
                        <h3>
                            <i class="fas fa-map"></i>
                            区域业务对比
                        </h3>
                        <div class="card-actions">
                            <select id="comparisonMetric" class="form-select">
                                <option value="area">监测面积</option>
                                <option value="yield">产量预估</option>
                                <option value="efficiency">监测效率</option>
                            </select>
                        </div>
                    </div>
                    <div class="card-content">
                        <div id="regionComparisonChart" class="chart-container"></div>
                    </div>
                </div>
                <!-- 数据处理效率 -->
                <div class="content-card">
                    <div class="card-header">
                        <h3>
                            <i class="fas fa-tachometer-alt"></i>
                            数据处理效率
                        </h3>
                    </div>
                    <div class="card-content">
                        <div class="efficiency-stats">
                            <div class="stat-item">
                                <div class="stat-label">
                                    <i class="fas fa-satellite"></i>
                                    遥感数据处理
                                </div>
                                <div class="stat-value">
                                    <span class="value">92.5%</span>
                                    <div class="progress-bar">
                                        <div class="progress-fill" style="width: 92.5%"></div>
                                    </div>
                                </div>
                            </div>
                            <div class="stat-item">
                                <div class="stat-label">
                                    <i class="fas fa-cloud"></i>
                                    气象数据处理
                                </div>
                                <div class="stat-value">
                                    <span class="value">96.8%</span>
                                    <div class="progress-bar">
                                        <div class="progress-fill" style="width: 96.8%"></div>
                                    </div>
                                </div>
                            </div>
                            <div class="stat-item">
                                <div class="stat-label">
                                    <i class="fas fa-microchip"></i>
                                    传感器数据处理
                                </div>
                                <div class="stat-value">
                                    <span class="value">89.3%</span>
                                    <div class="progress-bar">
                                        <div class="progress-fill" style="width: 89.3%"></div>
                                    </div>
                                </div>
                            </div>
                            <div class="stat-item">
                                <div class="stat-label">
                                    <i class="fas fa-chart-line"></i>
                                    算法分析处理
                                </div>
                                <div class="stat-value">
                                    <span class="value">94.1%</span>
                                    <div class="progress-bar">
                                        <div class="progress-fill" style="width: 94.1%"></div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <!-- 业务指标排行 -->
                <div class="content-card">
                    <div class="card-header">
                        <h3>
                            <i class="fas fa-trophy"></i>
                            业务指标排行
                        </h3>
                        <div class="card-actions">
                            <select id="rankingMetric" class="form-select">
                                <option value="area">监测面积</option>
                                <option value="accuracy">监测精度</option>
                                <option value="alerts">预警准确率</option>
                                <option value="yield">产量预估精度</option>
                            </select>
                        </div>
                    </div>
                    <div class="card-content">
                        <div class="ranking-list" id="rankingList">
                            <!-- 排行数据将通过JavaScript动态加载 -->
                        </div>
                    </div>
                </div>
            </div>
            <!-- 详细数据表格 -->
            <div class="content-card full-width">
                <div class="card-header">
                    <h3>
                        <i class="fas fa-table"></i>
                        详细业务数据
                    </h3>
                    <div class="card-actions">
                        <div class="search-box">
                            <i class="fas fa-search"></i>
                            <input type="text" placeholder="搜索业务数据..." id="searchBusiness">
                        </div>
                        <select id="businessFilter" class="form-select">
                            <option value="all">全部类型</option>
                            <option value="monitoring">监测业务</option>
                            <option value="analysis">分析业务</option>
                            <option value="forecast">预测业务</option>
                            <option value="alert">预警业务</option>
                        </select>
                        <button class="btn btn-secondary btn-sm" id="exportTableBtn">
                            <i class="fas fa-file-excel"></i>
                            导出表格
                        </button>
                    </div>
                </div>
                <div class="card-content">
                    <div class="table-container">
                        <table class="data-table" id="businessTable">
                            <thead>
                                <tr>
                                    <th>
                                        <input type="checkbox" id="selectAllBusiness">
                                    </th>
                                    <th>业务类型</th>
                                    <th>区域</th>
                                    <th>面积(公顷)</th>
                                    <th>作物类型</th>
                                    <th>监测精度</th>
                                    <th>处理时间</th>
                                    <th>状态</th>
                                    <th>操作</th>
                                </tr>
                            </thead>
                            <tbody id="businessTableBody">
                                <!-- 数据将通过JavaScript动态加载 -->
                            </tbody>
                        </table>
                    </div>
                    <div class="table-pagination">
                        <div class="pagination-info">
                            显示 <span id="businessPageStart">1</span> - <span id="businessPageEnd">10</span> 条，共 <span id="businessTotalRecords">156</span> 条记录
                        </div>
                        <div class="pagination-controls">
                            <button class="btn btn-ghost btn-sm" id="businessPrevPage" disabled>
                                <i class="fas fa-chevron-left"></i>
                            </button>
                            <span class="page-numbers" id="businessPageNumbers"></span>
                            <button class="btn btn-ghost btn-sm" id="businessNextPage">
                                <i class="fas fa-chevron-right"></i>
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </main>
    <!-- 业务详情模态框 -->
    <div class="modal-overlay" id="businessDetailModal">
        <div class="modal-content large">
            <div class="modal-header">
                <h3>业务详情</h3>
                <button class="modal-close" id="closeBusinessModal">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="modal-body">
                <div class="detail-tabs">
                    <button class="tab-btn active" data-tab="basic">基本信息</button>
                    <button class="tab-btn" data-tab="metrics">业务指标</button>
                    <button class="tab-btn" data-tab="timeline">处理时间线</button>
                </div>
                <div class="tab-content">
                    <div class="tab-pane active" id="basicTab">
                        <div class="detail-grid">
                            <div class="detail-item">
                                <label>业务类型</label>
                                <span id="detailBusinessType">-</span>
                            </div>
                            <div class="detail-item">
                                <label>监测区域</label>
                                <span id="detailRegion">-</span>
                            </div>
                            <div class="detail-item">
                                <label>监测面积</label>
                                <span id="detailArea">-</span>
                            </div>
                            <div class="detail-item">
                                <label>作物类型</label>
                                <span id="detailCropType">-</span>
                            </div>
                            <div class="detail-item">
                                <label>监测精度</label>
                                <span id="detailAccuracy">-</span>
                            </div>
                            <div class="detail-item">
                                <label>处理时间</label>
                                <span id="detailProcessTime">-</span>
                            </div>
                        </div>
                    </div>
                    <div class="tab-pane" id="metricsTab">
                        <div id="metricsChart" class="chart-container"></div>
                    </div>
                    <div class="tab-pane" id="timelineTab">
                        <div class="process-timeline" id="processTimeline">
                            <!-- 处理时间线将动态加载 -->
                        </div>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" id="viewOnMapBtn">
                    <i class="fas fa-map"></i>
                    地图查看
                </button>
                <button class="btn btn-primary" id="downloadDetailBtn">
                    <i class="fas fa-download"></i>
                    下载详情
                </button>
            </div>
        </div>
    </div>
    <!-- 加载中遮罩 -->
    <div class="loading-overlay" id="loadingOverlay">
        <div class="loading-spinner">
            <i class="fas fa-spinner fa-spin"></i>
            <p>正在生成报表...</p>
        </div>
    </div>
    <!-- 通知容器 -->
    <div class="notification-container" id="notificationContainer"></div>
    <!-- JavaScript文件 -->
    <script src="https://cdn.jsdelivr.net/npm/echarts@5.4.3/dist/echarts.min.js"></script>
    <script src="../../assets/js/common.js"></script>
    <script src="../../assets/js/business-statistics.js"></script>
    
    <!-- 导航修复脚本 - 业务统计页面 -->
    <script>
    document.addEventListener('DOMContentLoaded', function() {
        console.log('📊 业务统计页面 - 简化导航修复');
        
        // 简单直接的导航修复
        setTimeout(() => {
            // 1. 修复时间显示
            const currentTimeEl = document.getElementById('current-time');
            if (currentTimeEl) {
                const updateTime = () => {
                    const now = new Date();
                    currentTimeEl.textContent = now.toLocaleString('zh-CN');
                };
                updateTime();
                setInterval(updateTime, 1000);
            }
            
            // 2. 强制导航修复 - 直接操作
            const navGroups = document.querySelectorAll('.nav-group');
            console.log(`找到 ${navGroups.length} 个导航组`);
            
            navGroups.forEach((group, index) => {
                const navItem = group.querySelector('.nav-item');
                const submenu = group.querySelector('.nav-submenu');
                const navText = group.querySelector('.nav-text')?.textContent || `组${index+1}`;
                
                if (navItem && submenu) {
                    console.log(`处理导航组: ${navText}`);
                    
                    // 强制设置样式
                    submenu.style.overflow = 'hidden';
                    submenu.style.transition = 'max-height 0.3s ease';
                    submenu.style.display = 'block';
                    navItem.style.cursor = 'pointer';
                    navItem.style.userSelect = 'none';
                    
                    // 设置初始状态
                    if (group.classList.contains('expanded')) {
                        submenu.style.maxHeight = '500px';
                        console.log(`✓ ${navText} 初始展开`);
                    } else {
                        submenu.style.maxHeight = '0px';
                        console.log(`- ${navText} 初始收起`);
                    }
                    
                    // 移除旧事件，添加新事件
                    navItem.onclick = null;
                    navItem.addEventListener('click', function(e) {
                        e.preventDefault();
                        e.stopPropagation();
                        console.log(`🖱️ 点击导航组: ${navText}`);
                        
                        const isCurrentlyExpanded = group.classList.contains('expanded');
                        
                        if (isCurrentlyExpanded) {
                            group.classList.remove('expanded');
                            submenu.style.maxHeight = '0px';
                            console.log(`📁 ${navText} 已收起`);
                        } else {
                            group.classList.add('expanded');
                            submenu.style.maxHeight = '500px';
                            console.log(`📂 ${navText} 已展开`);
                        }
                    });
                    
                    console.log(`✅ 导航组 "${navText}" 事件绑定完成`);
                }
            });
            
            // 3. 高亮当前页面
            const currentItem = document.querySelector('a[href="business.html"]');
            if (currentItem) {
                currentItem.classList.add('active');
                console.log('✓ 业务统计页面已高亮');
            }
            
            console.log('✅ 业务统计页面导航修复完成');
        }, 100);
    });
    </script>
</body>
</html>
