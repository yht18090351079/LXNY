<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>农情遥感系统管理端 - 系统监控</title>
    
    <!-- 引入Font Awesome图标库 -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <!-- 引入管理端样式 -->
    <link rel="stylesheet" href="../../assets/css/common.css">
    <link rel="stylesheet" href="../../assets/css/system-settings.css">
</head>
<body>
    <!-- 顶部导航栏 -->
    <header class="header">
        <div class="header-left">
            <div class="logo">
                <i class="fas fa-seedling"></i>
                <span class="logo-text">农情遥感管理系统</span>
            </div>
        </div>
        
        <div class="header-center">
            <div class="breadcrumb">
                <i class="fas fa-home"></i>
                <span>系统设置</span>
                <i class="fas fa-chevron-right"></i>
                <span>系统监控</span>
            </div>
        </div>
        
        <div class="header-right">
            <div class="search-container">
                <i class="fas fa-search search-icon"></i>
                <input type="text" class="search-input" placeholder="搜索监控项...">
            </div>
            
            <div class="header-time">
                <i class="fas fa-clock"></i>
                <span id="current-time">2024-01-15 14:30:25</span>
            </div>
            
            <div class="user-menu">
                <div class="user-avatar" onclick="toggleUserMenu()">
                    <i class="fas fa-user"></i>
                    <span class="user-name">管理员</span>
                    <i class="fas fa-chevron-down"></i>
                </div>
                
                <div class="user-dropdown" id="userDropdown">
                    <a href="#" onclick="showUserProfile()">
                        <i class="fas fa-user-circle"></i>
                        个人信息
                    </a>
                    <a href="#" onclick="showSystemSettings()">
                        <i class="fas fa-cog"></i>
                        系统设置
                    </a>
                    <a href="#" onclick="logout()">
                        <i class="fas fa-sign-out-alt"></i>
                        退出登录
                    </a>
                </div>
            </div>
        </div>
    </header>

    <!-- 侧边栏导航 -->
    <aside class="sidebar" id="sidebar">
        <nav class="nav-menu">
            <!-- 仪表板 -->
            <div class="nav-item" onclick="window.location.href='../../index.html'">
                <i class="nav-icon fas fa-tachometer-alt"></i>
                <span class="nav-text">仪表板</span>
            </div>
            
            <!-- 数据管理 -->
            <div class="nav-group">
                <div class="nav-item">
                    <i class="nav-icon fas fa-database"></i>
                    <span class="nav-text">数据管理</span>
                    <i class="nav-arrow fas fa-chevron-right"></i>
                </div>
                <div class="nav-submenu">
                    <a href="../data-management/remote-sensing.html" class="nav-subitem">
                        <i class="fas fa-satellite"></i>
                        遥感数据管理
                    </a>
                    <a href="../data-management/weather-data.html" class="nav-subitem">
                        <i class="fas fa-cloud-sun"></i>
                        气象数据管理
                    </a>
                    <a href="../data-management/crop-data.html" class="nav-subitem">
                        <i class="fas fa-seedling"></i>
                        作物数据管理
                    </a>
                    <a href="../data-management/gis-data.html" class="nav-subitem">
                        <i class="fas fa-map"></i>
                        地理数据管理
                    </a>
                    <a href="../data-management/weather-alert-logs.html" class="nav-subitem">
                        <i class="fas fa-exclamation-triangle"></i>
                        预警信息留痕
                    </a>
                </div>
            </div>
            
            <!-- 设备管理 -->
            <div class="nav-group">
                <div class="nav-item">
                    <i class="nav-icon fas fa-microchip"></i>
                    <span class="nav-text">设备管理</span>
                    <i class="nav-arrow fas fa-chevron-right"></i>
                </div>
                <div class="nav-submenu">
                    <a href="../device-management/sensors.html" class="nav-subitem">
                        <i class="fas fa-thermometer-half"></i>
                        传感器管理
                    </a>
                    <a href="../device-management/device-monitoring.html" class="nav-subitem">
                        <i class="fas fa-video"></i>
                        监控设备
                    </a>
                    <a href="../device-management/maintenance.html" class="nav-subitem">
                        <i class="fas fa-tools"></i>
                        设备维护
                    </a>
                </div>
            </div>
            
            <!-- 用户管理 -->
            <div class="nav-group">
                <div class="nav-item">
                    <i class="nav-icon fas fa-users"></i>
                    <span class="nav-text">用户管理</span>
                    <i class="nav-arrow fas fa-chevron-right"></i>
                </div>
                <div class="nav-submenu">
                    <a href="../user-management/users.html" class="nav-subitem">
                        <i class="fas fa-user"></i>
                        用户账户
                    </a>
                    <a href="../user-management/roles.html" class="nav-subitem">
                        <i class="fas fa-user-tag"></i>
                        角色权限
                    </a>
                    <a href="../user-management/logs.html" class="nav-subitem">
                        <i class="fas fa-history"></i>
                        操作日志
                    </a>
                </div>
            </div>
            
            <!-- 系统设置 -->
            <div class="nav-group expanded">
                <div class="nav-item">
                    <i class="nav-icon fas fa-cogs"></i>
                    <span class="nav-text">系统设置</span>
                    <i class="nav-arrow fas fa-chevron-right"></i>
                </div>
                <div class="nav-submenu">
                    <a href="display.html" class="nav-subitem">
                        <i class="fas fa-desktop"></i>
                        大屏配置
                    </a>
                    <a href="algorithms.html" class="nav-subitem">
                        <i class="fas fa-brain"></i>
                        算法参数
                    </a>
                    <a href="system-monitoring.html" class="nav-subitem active">
                        <i class="fas fa-heartbeat"></i>
                        系统监控
                    </a>

                </div>
            </div>
            
            <!-- 统计报表 -->
            <div class="nav-group">
                <div class="nav-item">
                    <i class="nav-icon fas fa-chart-bar"></i>
                    <span class="nav-text">统计报表</span>
                    <i class="nav-arrow fas fa-chevron-right"></i>
                </div>
                <div class="nav-submenu">
                    <a href="../reports/data-quality.html" class="nav-subitem">
                        <i class="fas fa-check-circle"></i>
                        数据质量报告
                    </a>
                    <a href="../reports/business.html" class="nav-subitem">
                        <i class="fas fa-chart-line"></i>
                        业务统计
                    </a>
                    <a href="../reports/export.html" class="nav-subitem">
                        <i class="fas fa-download"></i>
                        数据导出
                    </a>
                </div>
            </div>
        </nav>
        
        <!-- 侧边栏底部 -->
        <div class="sidebar-footer">
            <div class="system-status">
                <div class="status-indicator">
                    <span class="status-dot online"></span>
                    <span class="status-text">系统运行正常</span>
                </div>
                <div class="status-time">
                    <small>最后更新: <span id="last-update">刚刚</span></small>
                </div>
            </div>
        </div>
    </aside>

    <!-- 主内容区域 -->
    <main class="main-content">
        <!-- 页面标题和操作 -->
        <div class="page-header">
            <div class="page-title">
                <h1>
                    <i class="fas fa-heartbeat"></i>
                    系统监控中心
                </h1>
                <p class="page-description">实时监控系统运行状态，确保农情遥感系统稳定高效运行</p>
            </div>
            
            <div class="page-actions">
                <button class="btn btn-secondary" onclick="refreshAllMetrics()">
                    <i class="fas fa-sync"></i>
                    刷新监控
                </button>
                <button class="btn btn-secondary" onclick="exportMetrics()">
                    <i class="fas fa-file-export"></i>
                    导出报告
                </button>
                <button class="btn btn-primary" onclick="configureAlerts()">
                    <i class="fas fa-bell"></i>
                    告警配置
                </button>
            </div>
        </div>

        <!-- 系统状态概览 -->
        <div class="system-overview">
            <div class="status-card healthy">
                <div class="status-icon">
                    <i class="fas fa-check-circle"></i>
                </div>
                <div class="status-content">
                    <h3>系统健康度</h3>
                    <div class="status-value">98.5%</div>
                    <div class="status-detail">各服务运行正常</div>
                </div>
                <div class="status-indicator-ring">
                    <svg class="ring-chart" viewBox="0 0 36 36">
                        <path class="ring-bg" d="M18 2.0845 a 15.9155 15.9155 0 0 1 0 31.831 a 15.9155 15.9155 0 0 1 0 -31.831"></path>
                        <path class="ring-progress" stroke-dasharray="98.5, 100" d="M18 2.0845 a 15.9155 15.9155 0 0 1 0 31.831 a 15.9155 15.9155 0 0 1 0 -31.831"></path>
                    </svg>
                </div>
            </div>
            
            <div class="status-card warning">
                <div class="status-icon">
                    <i class="fas fa-exclamation-triangle"></i>
                </div>
                <div class="status-content">
                    <h3>告警事件</h3>
                    <div class="status-value">3</div>
                    <div class="status-detail">2个警告，1个信息</div>
                </div>
                <div class="alert-list">
                    <div class="alert-item warning">
                        <i class="fas fa-triangle-exclamation"></i>
                        <span>磁盘使用率超过80%</span>
                    </div>
                </div>
            </div>
            
            <div class="status-card performance">
                <div class="status-icon">
                    <i class="fas fa-tachometer-alt"></i>
                </div>
                <div class="status-content">
                    <h3>系统性能</h3>
                    <div class="status-value">良好</div>
                    <div class="status-detail">响应时间 < 200ms</div>
                </div>
                <div class="performance-metrics">
                    <div class="metric-item">
                        <span class="metric-label">CPU</span>
                        <span class="metric-value">42%</span>
                    </div>
                    <div class="metric-item">
                        <span class="metric-label">内存</span>
                        <span class="metric-value">68%</span>
                    </div>
                </div>
            </div>
        </div>

        <!-- 监控仪表板 -->
        <div class="monitoring-dashboard">
            <!-- 系统资源监控 -->
            <div class="monitor-section">
                <div class="section-header">
                    <h3>
                        <i class="fas fa-server"></i>
                        系统资源监控
                    </h3>
                    <div class="section-actions">
                        <button class="btn-icon" onclick="toggleAutoRefresh()" data-tooltip="自动刷新">
                            <i class="fas fa-sync-alt"></i>
                        </button>
                        <button class="btn-icon" onclick="fullscreenChart('resources')" data-tooltip="全屏显示">
                            <i class="fas fa-expand"></i>
                        </button>
                    </div>
                </div>
                
                <div class="resource-monitors">
                    <div class="resource-monitor">
                        <div class="monitor-header">
                            <h4>CPU 使用率</h4>
                            <span class="current-value">42.3%</span>
                        </div>
                        <div class="progress-ring" data-progress="42.3">
                            <svg class="progress-ring-svg" width="120" height="120">
                                <circle class="progress-ring-bg" cx="60" cy="60" r="54"></circle>
                                <circle class="progress-ring-fill" cx="60" cy="60" r="54"></circle>
                            </svg>
                            <div class="progress-text">
                                <span class="progress-value">42.3%</span>
                                <span class="progress-label">CPU</span>
                            </div>
                        </div>
                        <div class="monitor-details">
                            <div class="detail-item">
                                <span>用户态:</span>
                                <span>28.5%</span>
                            </div>
                            <div class="detail-item">
                                <span>系统态:</span>
                                <span>13.8%</span>
                            </div>
                        </div>
                    </div>
                    
                    <div class="resource-monitor">
                        <div class="monitor-header">
                            <h4>内存使用率</h4>
                            <span class="current-value">68.7%</span>
                        </div>
                        <div class="progress-ring" data-progress="68.7">
                            <svg class="progress-ring-svg" width="120" height="120">
                                <circle class="progress-ring-bg" cx="60" cy="60" r="54"></circle>
                                <circle class="progress-ring-fill" cx="60" cy="60" r="54"></circle>
                            </svg>
                            <div class="progress-text">
                                <span class="progress-value">68.7%</span>
                                <span class="progress-label">内存</span>
                            </div>
                        </div>
                        <div class="monitor-details">
                            <div class="detail-item">
                                <span>已用:</span>
                                <span>5.5GB</span>
                            </div>
                            <div class="detail-item">
                                <span>可用:</span>
                                <span>2.5GB</span>
                            </div>
                        </div>
                    </div>
                    
                    <div class="resource-monitor">
                        <div class="monitor-header">
                            <h4>磁盘使用率</h4>
                            <span class="current-value">83.2%</span>
                        </div>
                        <div class="progress-ring warning" data-progress="83.2">
                            <svg class="progress-ring-svg" width="120" height="120">
                                <circle class="progress-ring-bg" cx="60" cy="60" r="54"></circle>
                                <circle class="progress-ring-fill" cx="60" cy="60" r="54"></circle>
                            </svg>
                            <div class="progress-text">
                                <span class="progress-value">83.2%</span>
                                <span class="progress-label">磁盘</span>
                            </div>
                        </div>
                        <div class="monitor-details">
                            <div class="detail-item">
                                <span>已用:</span>
                                <span>415GB</span>
                            </div>
                            <div class="detail-item">
                                <span>可用:</span>
                                <span>85GB</span>
                            </div>
                        </div>
                    </div>
                    
                    <div class="resource-monitor">
                        <div class="monitor-header">
                            <h4>网络吞吐量</h4>
                            <span class="current-value">125MB/s</span>
                        </div>
                        <div class="network-chart">
                            <div id="networkChart" class="mini-chart"></div>
                        </div>
                        <div class="monitor-details">
                            <div class="detail-item">
                                <span>上行:</span>
                                <span>45MB/s</span>
                            </div>
                            <div class="detail-item">
                                <span>下行:</span>
                                <span>80MB/s</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- 服务状态监控 -->
            <div class="monitor-section">
                <div class="section-header">
                    <h3>
                        <i class="fas fa-cogs"></i>
                        服务状态监控
                    </h3>
                    <div class="section-actions">
                        <button class="btn-icon" onclick="refreshServices()" data-tooltip="刷新服务">
                            <i class="fas fa-sync"></i>
                        </button>
                    </div>
                </div>
                
                <div class="service-grid">
                    <div class="service-card running">
                        <div class="service-header">
                            <div class="service-icon">
                                <i class="fas fa-database"></i>
                            </div>
                            <div class="service-status">
                                <span class="status-dot running"></span>
                                <span class="status-text">运行中</span>
                            </div>
                        </div>
                        <div class="service-info">
                            <h4>数据库服务</h4>
                            <p>PostgreSQL 主数据库</p>
                            <div class="service-metrics">
                                <span>连接数: 45/100</span>
                                <span>QPS: 1,250</span>
                            </div>
                        </div>
                        <div class="service-actions">
                            <button class="btn-sm" onclick="viewServiceLogs('database')">查看日志</button>
                            <button class="btn-sm" onclick="restartService('database')">重启</button>
                        </div>
                    </div>
                    
                    <div class="service-card running">
                        <div class="service-header">
                            <div class="service-icon">
                                <i class="fas fa-server"></i>
                            </div>
                            <div class="service-status">
                                <span class="status-dot running"></span>
                                <span class="status-text">运行中</span>
                            </div>
                        </div>
                        <div class="service-info">
                            <h4>API 服务</h4>
                            <p>后端接口服务</p>
                            <div class="service-metrics">
                                <span>请求数: 8,432</span>
                                <span>响应时间: 120ms</span>
                            </div>
                        </div>
                        <div class="service-actions">
                            <button class="btn-sm" onclick="viewServiceLogs('api')">查看日志</button>
                            <button class="btn-sm" onclick="restartService('api')">重启</button>
                        </div>
                    </div>
                    
                    <div class="service-card warning">
                        <div class="service-header">
                            <div class="service-icon">
                                <i class="fas fa-memory"></i>
                            </div>
                            <div class="service-status">
                                <span class="status-dot warning"></span>
                                <span class="status-text">警告</span>
                            </div>
                        </div>
                        <div class="service-info">
                            <h4>缓存服务</h4>
                            <p>Redis 缓存集群</p>
                            <div class="service-metrics">
                                <span>内存使用: 85%</span>
                                <span>命中率: 92%</span>
                            </div>
                        </div>
                        <div class="service-actions">
                            <button class="btn-sm" onclick="viewServiceLogs('cache')">查看日志</button>
                            <button class="btn-sm" onclick="restartService('cache')">重启</button>
                        </div>
                    </div>
                    
                    <div class="service-card running">
                        <div class="service-header">
                            <div class="service-icon">
                                <i class="fas fa-search"></i>
                            </div>
                            <div class="service-status">
                                <span class="status-dot running"></span>
                                <span class="status-text">运行中</span>
                            </div>
                        </div>
                        <div class="service-info">
                            <h4>搜索服务</h4>
                            <p>Elasticsearch 搜索引擎</p>
                            <div class="service-metrics">
                                <span>索引数: 12</span>
                                <span>文档数: 2.3M</span>
                            </div>
                        </div>
                        <div class="service-actions">
                            <button class="btn-sm" onclick="viewServiceLogs('search')">查看日志</button>
                            <button class="btn-sm" onclick="restartService('search')">重启</button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- 实时监控图表 -->
            <div class="monitor-section">
                <div class="section-header">
                    <h3>
                        <i class="fas fa-chart-line"></i>
                        实时监控图表
                    </h3>
                    <div class="time-range-selector">
                        <button class="time-btn active" onclick="setMonitorTimeRange('1h')">1小时</button>
                        <button class="time-btn" onclick="setMonitorTimeRange('6h')">6小时</button>
                        <button class="time-btn" onclick="setMonitorTimeRange('24h')">24小时</button>
                        <button class="time-btn" onclick="setMonitorTimeRange('7d')">7天</button>
                    </div>
                </div>
                
                <div class="charts-grid">
                    <div class="chart-container">
                        <div class="chart-header">
                            <h4>系统负载</h4>
                        </div>
                        <div id="systemLoadChart" class="chart"></div>
                    </div>
                    
                    <div class="chart-container">
                        <div class="chart-header">
                            <h4>响应时间</h4>
                        </div>
                        <div id="responseTimeChart" class="chart"></div>
                    </div>
                    
                    <div class="chart-container">
                        <div class="chart-header">
                            <h4>错误率</h4>
                        </div>
                        <div id="errorRateChart" class="chart"></div>
                    </div>
                    
                    <div class="chart-container">
                        <div class="chart-header">
                            <h4>数据处理量</h4>
                        </div>
                        <div id="dataVolumeChart" class="chart"></div>
                    </div>
                </div>
            </div>

            <!-- 告警管理 -->
            <div class="monitor-section">
                <div class="section-header">
                    <h3>
                        <i class="fas fa-bell"></i>
                        告警管理
                    </h3>
                    <div class="section-actions">
                        <button class="btn-icon" onclick="clearAllAlerts()" data-tooltip="清除所有告警">
                            <i class="fas fa-trash"></i>
                        </button>
                        <button class="btn btn-secondary" onclick="configureAlertRules()">
                            <i class="fas fa-cog"></i>
                            配置规则
                        </button>
                    </div>
                </div>
                
                <div class="alert-list-container">
                    <div class="alert-summary">
                        <div class="alert-count critical">
                            <span class="count">0</span>
                            <span class="label">严重</span>
                        </div>
                        <div class="alert-count warning">
                            <span class="count">2</span>
                            <span class="label">警告</span>
                        </div>
                        <div class="alert-count info">
                            <span class="count">1</span>
                            <span class="label">信息</span>
                        </div>
                    </div>
                    
                    <div class="alert-items" id="alertItems">
                        <!-- 告警项目将通过JavaScript生成 -->
                    </div>
                </div>
            </div>
        </div>
    </main>

    <!-- 侧边栏切换按钮 -->
    <button class="sidebar-toggle" id="sidebarToggle" onclick="toggleSidebar()">
        <i class="fas fa-bars"></i>
    </button>

    <!-- 告警配置模态框 -->
    <div class="modal-overlay" id="alertConfigModal">
        <div class="modal-content large">
            <div class="modal-header">
                <h3 class="modal-title">告警规则配置</h3>
                <button class="modal-close" onclick="closeAlertConfigModal()">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="modal-body">
                <div class="alert-config-content">
                    <!-- 告警配置内容将通过JavaScript生成 -->
                </div>
            </div>
            <div class="modal-actions">
                <button class="btn btn-secondary" onclick="closeAlertConfigModal()">取消</button>
                <button class="btn btn-primary" onclick="saveAlertConfig()">保存配置</button>
            </div>
        </div>
    </div>

    <!-- 引入JavaScript文件 -->
    <script src="https://cdn.jsdelivr.net/npm/echarts@5.4.3/dist/echarts.min.js"></script>
    <script src="../../assets/js/common.js"></script>
    <script src="../../assets/js/system-monitoring.js"></script>
    
    <!-- 页面加载检查和修复脚本 -->
    <script>
    // 系统监控页面加载检查和导航修复 - 增强版
    document.addEventListener('DOMContentLoaded', function() {
        console.log('🖥️ 系统监控页面加载检查...');
        console.log('🔍 诊断模式：检查页面基础元素...');
        
        // 基础诊断
        const sidebar = document.querySelector('.sidebar');
        const navGroups = document.querySelectorAll('.nav-group');
        const systemSettingsGroup = document.querySelector('.nav-group.expanded');
        
        console.log('📊 诊断结果:');
        console.log(`- 侧边栏: ${sidebar ? '✓ 存在' : '❌ 缺失'}`);
        console.log(`- 导航组数量: ${navGroups.length}`);
        console.log(`- 系统设置组: ${systemSettingsGroup ? '✓ 找到' : '❌ 未找到'}`);
        
        if (typeof initializeSidebar === 'function') {
            console.log('✓ common.js 已加载');
        } else {
            console.log('❌ common.js 未正确加载');
        }
        
        // 检查ECharts是否加载
        if (typeof echarts !== 'undefined') {
            console.log('✓ ECharts 已加载');
        } else {
            console.log('❌ ECharts 未正确加载');
        }
        
        // 确保基础功能正常
        setTimeout(() => {
            // 检查并修复时间显示
            const currentTimeEl = document.getElementById('current-time');
            if (currentTimeEl && currentTimeEl.textContent === '2024-01-15 14:30:25') {
                const updateTime = () => {
                    const now = new Date();
                    currentTimeEl.textContent = now.toLocaleString('zh-CN');
                };
                updateTime();
                setInterval(updateTime, 1000);
            }
            
            // 强化导航修复
            console.log('🔧 执行系统监控页面导航强化修复...');
            
            // 1. 确保系统设置组展开
            const systemGroup = document.querySelector('.nav-group.expanded');
            if (systemGroup) {
                const submenu = systemGroup.querySelector('.nav-submenu');
                if (submenu) {
                    submenu.style.maxHeight = submenu.scrollHeight + 'px';
                    console.log('✓ 系统设置组已展开');
                }
            }
            
            // 2. 确保当前页面高亮
            const currentNavItem = document.querySelector('a[href="system-monitoring.html"].nav-subitem');
            if (currentNavItem) {
                currentNavItem.classList.add('active');
                console.log('✓ 系统监控页面已高亮');
            }
            
            // 3. 添加导航组点击事件
            const navGroups = document.querySelectorAll('.nav-group');
            navGroups.forEach(group => {
                const header = group.querySelector('.nav-item');
                const submenu = group.querySelector('.nav-submenu');
                if (header && submenu) {
                    header.addEventListener('click', (e) => {
                        e.preventDefault();
                        if (group.classList.contains('expanded')) {
                            group.classList.remove('expanded');
                            submenu.style.maxHeight = '0';
                        } else {
                            group.classList.add('expanded');
                            submenu.style.maxHeight = submenu.scrollHeight + 'px';
                        }
                    });
                }
            });
            
            // 4. 确保通用导航功能
            if (typeof initializeSidebar === 'function') {
                initializeSidebar();
                console.log('✓ 通用导航初始化完成');
            }
            
            console.log('✅ 系统监控页面导航修复完成');
        }, 500);
    });
    </script>
</body>
</html>