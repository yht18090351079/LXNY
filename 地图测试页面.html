<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ä¸´å¤å†œæƒ…é¥æ„Ÿç³»ç»Ÿ - åœ°å›¾æœåŠ¡æµ‹è¯•</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <style>
        body {
            font-family: 'Microsoft YaHei', sans-serif;
            margin: 0;
            padding: 20px;
            background: #f5f5f5;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 10px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.1);
            overflow: hidden;
        }
        
        .header {
            background: linear-gradient(135deg, #3498db, #2c3e50);
            color: white;
            padding: 20px;
            text-align: center;
        }
        
        .header h1 {
            margin: 0;
            font-size: 2rem;
        }
        
        .header p {
            margin: 10px 0 0 0;
            opacity: 0.9;
        }
        
        .controls {
            padding: 20px;
            background: #f8f9fa;
            border-bottom: 1px solid #e9ecef;
        }
        
        .control-group {
            display: inline-block;
            margin-right: 20px;
            margin-bottom: 10px;
        }
        
        .control-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
            color: #2c3e50;
        }
        
        .control-group select,
        .control-group button {
            padding: 8px 15px;
            border: 1px solid #ddd;
            border-radius: 5px;
            background: white;
            cursor: pointer;
        }
        
        .control-group button {
            background: #3498db;
            color: white;
            border: none;
        }
        
        .control-group button:hover {
            background: #2980b9;
        }
        
        .status {
            display: inline-block;
            padding: 5px 10px;
            border-radius: 15px;
            font-size: 0.9rem;
            margin-left: 10px;
        }
        
        .status.success {
            background: #d4edda;
            color: #155724;
        }
        
        .status.error {
            background: #f8d7da;
            color: #721c24;
        }
        
        .status.loading {
            background: #fff3cd;
            color: #856404;
        }
        
        #map {
            height: 600px;
            width: 100%;
        }
        
        .info-panel {
            padding: 20px;
            background: #f8f9fa;
        }
        
        .service-list {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 15px;
            margin-top: 15px;
        }
        
        .service-item {
            background: white;
            padding: 15px;
            border-radius: 8px;
            border-left: 4px solid #3498db;
        }
        
        .service-item h4 {
            margin: 0 0 5px 0;
            color: #2c3e50;
        }
        
        .service-item p {
            margin: 0;
            color: #7f8c8d;
            font-size: 0.9rem;
        }
        
        .coordinates {
            position: absolute;
            bottom: 10px;
            left: 10px;
            background: rgba(0,0,0,0.7);
            color: white;
            padding: 5px 10px;
            border-radius: 5px;
            font-size: 0.8rem;
            z-index: 1000;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸ—ºï¸ åœ°å›¾æœåŠ¡æµ‹è¯•é¡µé¢</h1>
            <p>æµ‹è¯•å›½å†…åœ°å›¾æœåŠ¡é…ç½®æ˜¯å¦æ­£å¸¸å·¥ä½œ</p>
        </div>
        
        <div class="controls">
            <div class="control-group">
                <label for="mapProvider">åœ°å›¾æœåŠ¡å•†:</label>
                <select id="mapProvider">
                    <option value="amap">é«˜å¾·åœ°å›¾</option>
                    <option value="tencent">è…¾è®¯åœ°å›¾</option>
                    <option value="osm-china">OpenStreetMap(æ¸…åé•œåƒ)</option>
                </select>
            </div>
            
            <div class="control-group">
                <label for="mapType">åœ°å›¾ç±»å‹:</label>
                <select id="mapType">
                    <option value="standard">æ ‡å‡†åœ°å›¾</option>
                    <option value="satellite">å«æ˜Ÿå½±åƒ</option>
                </select>
            </div>
            
            <div class="control-group">
                <label>&nbsp;</label>
                <button onclick="switchMapLayer()">åˆ‡æ¢å›¾å±‚</button>
                <button onclick="resetView()">é‡ç½®è§†å›¾</button>
                <button onclick="testAllServices()">æµ‹è¯•æ‰€æœ‰æœåŠ¡</button>
            </div>
            
            <span id="status" class="status loading">æ­£åœ¨åŠ è½½åœ°å›¾...</span>
        </div>
        
        <div id="map"></div>
        <div class="coordinates" id="coordinates">é¼ æ ‡ç§»åŠ¨åˆ°åœ°å›¾ä¸ŠæŸ¥çœ‹åæ ‡</div>
        
        <div class="info-panel">
            <h3>ğŸ”§ é…ç½®ä¿¡æ¯</h3>
            <p><strong>å½“å‰ä½ç½®:</strong> ä¸´å¤å¿ (35.6Â°N, 103.1Â°E)</p>
            <p><strong>åæ ‡ç³»ç»Ÿ:</strong> GCJ-02 (ç«æ˜Ÿåæ ‡ç³») - é€‚ç”¨äºä¸­å›½å¤§é™†</p>
            <p><strong>åœ°å›¾èŒƒå›´:</strong> ä¸´å¤å›æ—è‡ªæ²»å·åŠå‘¨è¾¹åœ°åŒº</p>
            
            <h4>ğŸ“¡ å¯ç”¨åœ°å›¾æœåŠ¡</h4>
            <div class="service-list">
                <div class="service-item">
                    <h4>ğŸŒ é«˜å¾·åœ°å›¾</h4>
                    <p>ä¸»è¦åœ°å›¾æœåŠ¡å•†ï¼Œæä¾›æ ‡å‡†åœ°å›¾å’Œå«æ˜Ÿå½±åƒ</p>
                </div>
                <div class="service-item">
                    <h4>ğŸ—ºï¸ è…¾è®¯åœ°å›¾</h4>
                    <p>å¤‡ç”¨åœ°å›¾æœåŠ¡å•†ï¼Œæä¾›æ ‡å‡†åœ°å›¾å’Œå«æ˜Ÿå½±åƒ</p>
                </div>
                <div class="service-item">
                    <h4>ğŸŒ OpenStreetMap</h4>
                    <p>å¼€æºåœ°å›¾ï¼Œä½¿ç”¨æ¸…åå¤§å­¦é•œåƒæœåŠ¡</p>
                </div>
                <div class="service-item">
                    <h4>ğŸ›°ï¸ å¤©åœ°å›¾</h4>
                    <p>å®˜æ–¹åœ°å›¾æœåŠ¡(éœ€è¦APIå¯†é’¥)</p>
                </div>
            </div>
        </div>
    </div>

    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <script src="domestic-map-config.js"></script>
    <script>
        // å…¨å±€å˜é‡
        let map = null;
        let currentLayer = null;
        
        // åœ°å›¾é…ç½®
        const mapConfigs = {
            amap: {
                standard: {
                    url: 'https://webrd0{s}.is.autonavi.com/appmaptile?lang=zh_cn&size=1&scale=1&style=8&x={x}&y={y}&z={z}',
                    subdomains: ['1', '2', '3', '4'],
                    attribution: 'Â© é«˜å¾·åœ°å›¾'
                },
                satellite: {
                    url: 'https://webst0{s}.is.autonavi.com/appmaptile?style=6&x={x}&y={y}&z={z}',
                    subdomains: ['1', '2', '3', '4'],
                    attribution: 'Â© é«˜å¾·åœ°å›¾'
                }
            },
            tencent: {
                standard: {
                    url: 'https://rt{s}.map.gtimg.com/tile?z={z}&x={x}&y={y}&type=vector&styleid=3',
                    subdomains: ['0', '1', '2', '3'],
                    attribution: 'Â© è…¾è®¯åœ°å›¾'
                },
                satellite: {
                    url: 'https://p{s}.map.gtimg.com/sateTiles/{z}/{x}/{y}.jpg',
                    subdomains: ['0', '1', '2', '3'],
                    attribution: 'Â© è…¾è®¯åœ°å›¾'
                }
            },
            'osm-china': {
                standard: {
                    url: 'https://mirrors.tuna.tsinghua.edu.cn/osm/{z}/{x}/{y}.png',
                    subdomains: [],
                    attribution: 'Â© OpenStreetMap contributors, æ¸…åå¤§å­¦é•œåƒ'
                },
                satellite: {
                    url: 'https://mirrors.tuna.tsinghua.edu.cn/osm/{z}/{x}/{y}.png',
                    subdomains: [],
                    attribution: 'Â© OpenStreetMap contributors, æ¸…åå¤§å­¦é•œåƒ'
                }
            }
        };
        
        // åˆå§‹åŒ–åœ°å›¾
        function initMap() {
            updateStatus('æ­£åœ¨åˆå§‹åŒ–åœ°å›¾...', 'loading');
            
            try {
                // åˆ›å»ºåœ°å›¾å®ä¾‹
                map = L.map('map').setView([35.6, 103.1], 10);
                
                // æ·»åŠ é»˜è®¤å›¾å±‚
                switchMapLayer();
                
                // æ·»åŠ é¼ æ ‡ç§»åŠ¨äº‹ä»¶
                map.on('mousemove', function(e) {
                    const lat = e.latlng.lat.toFixed(4);
                    const lng = e.latlng.lng.toFixed(4);
                    document.getElementById('coordinates').textContent = 
                        `åæ ‡: ${lat}Â°N, ${lng}Â°E`;
                });
                
                // æ·»åŠ ç‚¹å‡»äº‹ä»¶
                map.on('click', function(e) {
                    const lat = e.latlng.lat.toFixed(4);
                    const lng = e.latlng.lng.toFixed(4);
                    L.popup()
                        .setLatLng(e.latlng)
                        .setContent(`
                            <strong>ç‚¹å‡»ä½ç½®</strong><br>
                            çº¬åº¦: ${lat}Â°N<br>
                            ç»åº¦: ${lng}Â°E<br>
                            <small>åæ ‡ç³»: GCJ-02</small>
                        `)
                        .openOn(map);
                });
                
                updateStatus('åœ°å›¾åŠ è½½æˆåŠŸ', 'success');
            } catch (error) {
                console.error('åœ°å›¾åˆå§‹åŒ–å¤±è´¥:', error);
                updateStatus('åœ°å›¾åŠ è½½å¤±è´¥: ' + error.message, 'error');
            }
        }
        
        // åˆ‡æ¢åœ°å›¾å›¾å±‚
        function switchMapLayer() {
            const provider = document.getElementById('mapProvider').value;
            const type = document.getElementById('mapType').value;
            
            updateStatus('æ­£åœ¨åˆ‡æ¢å›¾å±‚...', 'loading');
            
            try {
                // ç§»é™¤å½“å‰å›¾å±‚
                if (currentLayer) {
                    map.removeLayer(currentLayer);
                }
                
                // è·å–é…ç½®
                const config = mapConfigs[provider][type];
                
                // åˆ›å»ºæ–°å›¾å±‚
                const layerOptions = {
                    maxZoom: 18,
                    attribution: config.attribution
                };
                
                if (config.subdomains.length > 0) {
                    layerOptions.subdomains = config.subdomains;
                }
                
                currentLayer = L.tileLayer(config.url, layerOptions);
                currentLayer.addTo(map);
                
                // ç›‘å¬å›¾å±‚åŠ è½½äº‹ä»¶
                currentLayer.on('loading', () => {
                    updateStatus('æ­£åœ¨åŠ è½½å›¾å±‚...', 'loading');
                });
                
                currentLayer.on('load', () => {
                    updateStatus(`${getProviderName(provider)} - ${getTypeName(type)} åŠ è½½æˆåŠŸ`, 'success');
                });
                
                currentLayer.on('tileerror', (e) => {
                    console.warn('å›¾å±‚åŠ è½½é”™è¯¯:', e);
                    updateStatus('éƒ¨åˆ†å›¾å±‚åŠ è½½å¤±è´¥', 'error');
                });
                
            } catch (error) {
                console.error('å›¾å±‚åˆ‡æ¢å¤±è´¥:', error);
                updateStatus('å›¾å±‚åˆ‡æ¢å¤±è´¥: ' + error.message, 'error');
            }
        }
        
        // é‡ç½®è§†å›¾
        function resetView() {
            if (map) {
                map.setView([35.6, 103.1], 10);
                updateStatus('è§†å›¾å·²é‡ç½®', 'success');
            }
        }
        
        // æµ‹è¯•æ‰€æœ‰æœåŠ¡
        async function testAllServices() {
            updateStatus('æ­£åœ¨æµ‹è¯•æ‰€æœ‰åœ°å›¾æœåŠ¡...', 'loading');
            
            const results = [];
            
            for (const [providerKey, provider] of Object.entries(mapConfigs)) {
                for (const [typeKey, config] of Object.entries(provider)) {
                    try {
                        const success = await testMapService(config.url, config.subdomains);
                        results.push({
                            provider: getProviderName(providerKey),
                            type: getTypeName(typeKey),
                            success: success
                        });
                    } catch (error) {
                        results.push({
                            provider: getProviderName(providerKey),
                            type: getTypeName(typeKey),
                            success: false,
                            error: error.message
                        });
                    }
                }
            }
            
            // æ˜¾ç¤ºæµ‹è¯•ç»“æœ
            showTestResults(results);
        }
        
        // æµ‹è¯•å•ä¸ªåœ°å›¾æœåŠ¡
        async function testMapService(url, subdomains) {
            const testUrl = url
                .replace('{s}', subdomains[0] || '')
                .replace('{z}', '10')
                .replace('{x}', '823')
                .replace('{y}', '375');
            
            try {
                const response = await fetch(testUrl, { 
                    method: 'HEAD',
                    mode: 'no-cors'  // é¿å…CORSé—®é¢˜
                });
                return true;  // å¦‚æœæ²¡æœ‰æŠ›å‡ºå¼‚å¸¸ï¼Œè®¤ä¸ºæœåŠ¡å¯ç”¨
            } catch (error) {
                return false;
            }
        }
        
        // æ˜¾ç¤ºæµ‹è¯•ç»“æœ
        function showTestResults(results) {
            const successful = results.filter(r => r.success).length;
            const total = results.length;
            
            let message = `æµ‹è¯•å®Œæˆ: ${successful}/${total} ä¸ªæœåŠ¡å¯ç”¨\n\n`;
            
            results.forEach(result => {
                const status = result.success ? 'âœ…' : 'âŒ';
                message += `${status} ${result.provider} - ${result.type}\n`;
                if (!result.success && result.error) {
                    message += `   é”™è¯¯: ${result.error}\n`;
                }
            });
            
            alert(message);
            
            if (successful > 0) {
                updateStatus(`æµ‹è¯•å®Œæˆ: ${successful}/${total} ä¸ªæœåŠ¡å¯ç”¨`, 'success');
            } else {
                updateStatus('æµ‹è¯•å®Œæˆ: æ‰€æœ‰æœåŠ¡éƒ½ä¸å¯ç”¨', 'error');
            }
        }
        
        // æ›´æ–°çŠ¶æ€æ˜¾ç¤º
        function updateStatus(message, type) {
            const statusEl = document.getElementById('status');
            statusEl.textContent = message;
            statusEl.className = `status ${type}`;
        }
        
        // è·å–æœåŠ¡å•†åç§°
        function getProviderName(key) {
            const names = {
                'amap': 'é«˜å¾·åœ°å›¾',
                'tencent': 'è…¾è®¯åœ°å›¾',
                'osm-china': 'OpenStreetMap'
            };
            return names[key] || key;
        }
        
        // è·å–ç±»å‹åç§°
        function getTypeName(key) {
            const names = {
                'standard': 'æ ‡å‡†åœ°å›¾',
                'satellite': 'å«æ˜Ÿå½±åƒ'
            };
            return names[key] || key;
        }
        
        // é¡µé¢åŠ è½½å®Œæˆååˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', function() {
            initMap();
            
            // ç»‘å®šæ§ä»¶äº‹ä»¶
            document.getElementById('mapProvider').addEventListener('change', switchMapLayer);
            document.getElementById('mapType').addEventListener('change', switchMapLayer);
        });
    </script>
</body>
</html>